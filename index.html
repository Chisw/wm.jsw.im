<!DOCTYPE html>
<html lang="en">
<head>
  <title>Web Monitor</title>
  <meta charset="UTF-8">
  <style>
    * {
      margin: 0;
      padding: 0;
    }

    html, body {
      width: 100%;
      height: 100%;
      background: #000;
    }

  </style>
</head>
<body>

  <div style="position: fixed; z-index: 10; padding: 6px 8px; background: rgba(0, 0, 0, .4); border-radius: 0 0 4px 0; font-size: 12px; color: #fff;">
    <label for="videoSelect">Video:</label>
    <select id="videoSelect"></select>
    <label for="audioSelect">Audio:</label>
    <select id="audioSelect"></select>
  </div>

  <div style="position: fixed; z-index: 0; inset: 0;">
    <video
      autoplay
      playsinline
      controls
      id="video"
      style="width: 100%; height: 100%; object-fit: contain;"
    >
    </video>
  </div>

  <script>
    const videoElement = document.getElementById('video');
    const videoSelect = document.getElementById('videoSelect');
    const audioSelect = document.getElementById('audioSelect');

    async function getMediaDevices() {
      try {
        // 请求权限
        await navigator.mediaDevices.getUserMedia({ audio: true, video: true });

        // 获取设备列表
        const devices = await navigator.mediaDevices.enumerateDevices();

        const videoInputs = devices.filter(d => d.kind === 'videoinput');
        const audioInputs = devices.filter(d => d.kind === 'audioinput');

        // 填充摄像头下拉
        videoSelect.innerHTML = '';
        videoInputs.forEach(device => {
          const option = document.createElement('option');
          option.value = device.deviceId;
          option.text = device.label || `Camera ${videoSelect.length + 1}`;
          videoSelect.appendChild(option);
        });

        // 填充麦克风下拉
        audioSelect.innerHTML = '';
        audioInputs.forEach(device => {
          const option = document.createElement('option');
          option.value = device.deviceId;
          option.text = device.label || `Microphone ${audioSelect.length + 1}`;
          audioSelect.appendChild(option);
        });

      } catch (err) {
        console.error('获取设备失败:', err);
      }
    }

    async function startStream() {
      if (window.stream) {
        // 停掉旧的流
        window.stream.getTracks().forEach(track => track.stop());
      }

      const videoId = videoSelect.value;
      const audioId = audioSelect.value;

      const constraints = {
        video: { deviceId: videoId ? { exact: videoId } : undefined },
        audio: { deviceId: audioId ? { exact: audioId } : undefined }
      };

      try {
        const stream = await navigator.mediaDevices.getUserMedia(constraints);
        window.stream = stream;
        videoElement.srcObject = stream;
      } catch (err) {
        console.error('启动流失败:', err);
      }
    }

    // 初始加载设备列表
    getMediaDevices().then(startStream);

    // 切换设备时更新流
    videoSelect.onchange = startStream;
    audioSelect.onchange = startStream;

    // 监听设备变化（插拔摄像头/麦克风）
    navigator.mediaDevices.ondevicechange = getMediaDevices;
  </script>
</body>
</html>
